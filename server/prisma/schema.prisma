generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               Int       @id @default(autoincrement())
  email            String    @unique
  password         String
  nume             String
  prenume          String
  functie          String
  role             String
  telefon          String?
  profilePicture   String?
  digitalSignature String?
  locatie          String?
  departament      String?
  lastLogin        DateTime?
  createdAt        DateTime  @default(now())
  sessions         Session[]
}

model DepartmentConfig {
  id                  String    @id @default(uuid())
  name                String
  defaultLicenses     String[]  @default([])
  defaultRequirements String[]  @default([])
  angajati            Angajat[]
}

model Angajat {
  id                      String             @id @default(uuid())
  numeComplet             String
  functie                 String
  email                   String?
  telefon                 String?
  dataAngajare            DateTime           @default(now())
  cDataUsername           String?
  cDataId                 String?
  cDataNotes              String?
  cDataCreated            Boolean            @default(false)
  emailAccountCreatedAt   DateTime?
  emailAccountResponsible String?
  emailAccountLink        String?
  isActive                Boolean            @default(true)
  archivedAt              DateTime?
  archivedBy              String?
  echipamente             Echipament[]
  createdAt               DateTime           @default(now())
  proceseVerbale          ProcesVerbal[]
  equipmentChanges        EquipmentChange[]
  departmentConfigId      String?
  departmentConfig        DepartmentConfig?  @relation(fields: [departmentConfigId], references: [id])
  checklist               String[]           @default([])
  licenses                String[]           @default([])
  onboarding              Onboarding[]
  documents               AngajatDocument[]
}

model Echipament {
  id               String              @id @default(uuid())
  nume             String
  tip              String
  serie            String
  stare            String
  cpu              String?
  ram              String?
  stocare          String?
  os               String?
  versiuneFirmware String?
  numarInventar    String?
  dataAchizitie    DateTime?
  garantie         DateTime?
  metadata         Json?
  defectAt         DateTime?
  angajatId        String?
  angajat          Angajat?            @relation(fields: [angajatId], references: [id])
  createdAt        DateTime            @default(now())
  proceseVerbale   ProcesVerbal[]      @relation("EchipamenteProcesVerbal")
  changes          EquipmentChange[]
  documents        EquipmentDocument[]
  images           EquipmentImage[]
}

model Eveniment {
  id         Int      @id @default(autoincrement())
  titlu      String
  data       DateTime
  ora        String
  userId     Int
  recurrence String   @default("none") 
}

model ProcesVerbal {
  id           String          @id @default(uuid())
  angajatId    String
  angajat      Angajat         @relation(fields: [angajatId], references: [id])
  echipamente  Echipament[]    @relation("EchipamenteProcesVerbal")
  dataGenerare DateTime        @default(now())
  observatii   String?
  tip          ProcesVerbalTip @default(PREDARE_PRIMIRE)
  documentPath String?
}

enum ProcesVerbalTip {
  PREDARE_PRIMIRE
  RESTITUIRE
  SCHIMB
}

model EquipmentChange {
  id           String              @id @default(uuid())
  angajatId    String
  echipamentId String
  tip          EquipmentChangeType
  includedInPV Boolean             @default(false)
  createdAt    DateTime            @default(now())

  angajat    Angajat    @relation(fields: [angajatId], references: [id])
  echipament Echipament @relation(fields: [echipamentId], references: [id])
}

enum EquipmentChangeType {
  ASSIGN
  RETURN
  REPLACE
}

model EquipmentDocument {
  id           String     @id @default(uuid())
  echipamentId String
  echipament   Echipament @relation(fields: [echipamentId], references: [id])
  name         String
  path         String
  createdAt    DateTime   @default(now())
}

model AngajatDocument {
  id           String                @id @default(uuid())
  angajatId    String
  angajat      Angajat               @relation(fields: [angajatId], references: [id], onDelete: Cascade)
  name         String
  path         String
  type         String?
  size         Int?
  documentType DocumentType          @default(OTHER)
  uploadYear   Int
  createdAt    DateTime              @default(now())
  uploadedBy   String?
  accessLogs   DocumentAccessLog[]
}

enum DocumentType {
  PROCES_VERBAL
  CONTRACT_ANGAJARE
  CONTRACT_MUNCA
  CERTIFICAT
  DIPLOMA
  EVALUARE
  AVERTISMENT
  DECIZIE
  CERERE
  ALTA_CORESPONDENTA
  OTHER
}

model DocumentAccessLog {
  id               String          @id @default(uuid())
  documentId       String
  document         AngajatDocument @relation(fields: [documentId], references: [id], onDelete: Cascade)
  userId           Int
  userEmail        String
  userName         String
  action           String          @default("VIEW")
  ipAddress        String?
  timestamp        DateTime        @default(now())
}

model EquipmentImage {
  id           String     @id @default(uuid())
  echipamentId String
  echipament   Echipament @relation(fields: [echipamentId], references: [id])
  url          String
  createdAt    DateTime   @default(now())
}

model Session {
  id              String   @id @default(uuid())
  userId          Int
  tokenHash       String   @unique
  userAgent       String?
  deviceName      String?
  deviceType      String?
  osName          String?
  browserName     String?
  ipAddress       String?
  locationCity    String?
  locationCountry String?
  createdAt       DateTime @default(now())
  lastActive      DateTime @default(now())
  expiresAt       DateTime?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model PurchaseRequest {
  id            String                @id @default(uuid())
  equipmentType String
  quantity      Int
  status        PurchaseRequestStatus @default(PENDING)
  createdAt     DateTime              @default(now())
}

enum PurchaseRequestStatus {
  PENDING
  ORDERED
  DELIVERED
}

model Onboarding {
  id         String   @id @default(uuid())
  angajatId  String?
  angajat    Angajat? @relation(fields: [angajatId], references: [id])
  department String
  laptopId   String
  tasks      Json
  createdAt  DateTime @default(now())
}